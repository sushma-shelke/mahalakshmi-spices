<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0">
<!-- Site Icons -->
<link rel="shortcut icon" href="images/logo-removebg-preview.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/logo-removebg-preview.png">
    <!-- Site Metas -->
    <title>Mahalaxmi Masala</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- color -->
    <link id="changeable-colors" rel="stylesheet" href="css/colors/orange.css" />

    <!-- Modernizer -->
    <script src="js/modernizer.js"></script>
    <!-- color -->
    <link
      id="changeable-colors"
      rel="stylesheet"
      href="css/colors/orange.css"
    />
    <script
      src="https://kit.fontawesome.com/b27d57f29f.js"
      crossorigin="anonymous"
    ></script>
    <!-- Modernizer -->
    <script src="js/modernizer.js"></script>
    <style>
      .header-block-top {
        background-color: #1a1a1a;
      }
      body {
        background-color: #f8f9fa;
        padding-top: 20px;
      }
      .edit-container {
        /* max-width: 800px;     */
        margin: 40px auto;
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      }
      .form-label {
        font-weight: 500;
        margin-bottom: 8px;
      }
      .header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      .loading-spinner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
      #site-header {
        background-color: #1a1a1a;
        padding: 0;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
      }

      .nav-link {
        /* padding: 20px !important; */
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 1px;
      }

      .nav-link:hover {
        color: #ff0000 !important;
      }

      .logo img {
        max-height: 60px;
        margin: 10px;
      }

      .navbar-toggler {
        border-color: white;
        margin-right: 15px;
      }

      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3e%3cpath stroke='rgba(255, 255, 255, 0.5)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }
.col-md-6,.col-12{
padding-left: 15px;
padding-right:15px;
}
      @media (max-width: 991px) {
        .navbar-collapse {
          background-color: #1a1a1a;
          padding: 15px;
          position: absolute;
          top: 100%;
          right: 0;
          left: 0;
        }

        .nav-link {
          padding: 10px 20px !important;
        }
      }
    </style>
  </head>
  <body>
    <div id="site-header" style="background-color: #1a1a1a">
      <header id="header" class="header-block-top">
        <div class="container-fluid">
          <div class="row">
            <!-- <div class="col-12 d-flex justify-content-between align-items-center">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/logo-removebg-preview.png" alt="Mahalaxmi Logo" style="max-height: 60px; margin: 10px;">
                    </a>
                </div> -->
                <div class="main-menu">
                    <nav class="navbar navbar-default" id="mainNav">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <div class="logo">
                                <a class="navbar-brand js-scroll-trigger logo-header" href="#">
                                  <img src="images/mahalaxmi-logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div id="navbar" class="navbar-collapse collapse">
                            <ul class="nav navbar-nav navbar-right">
                                <li ><a href="./index.html">HOME</a></li> 
                                <li ><a href="index.html#about">ABOUT</a></li>
                                <li ><a href="index.html#special-collection">COLLECTION</a></li>
                                <li ><a href="index.html#our_team">NEWS</a></li>
                                <!-- <li ><a href="index.html#contact">CONTACT</a></li> -->
                                <li  ><a href="./stockAllocationForm.html">INVESTOR FORM</a></li>
                                <li><a href="./varifiedCertificate.html">Certificate Verify</a></li>
                                <!--<li><a href="#">View Certificate</a></li>-->
                                <!-- <li><a href="./login.html">Login</a></li> -->
                             
                            </ul>
                        </div>
                        <!-- end nav-collapse -->
                    </nav>
                    <!-- <nav class="navbar navbar-expand-lg">
                        <button
                          class="navbar-toggler"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#navbar"
                        >
                          <span class="navbar-toggler-icon"></span>
                        </button>
                        <div id="navbar" class="collapse navbar-collapse">
                          <ul class="navbar-nav ms-auto">
                            <li style="padding-top: 20px">
                              <a href="./index.html">HOME</a>
                            </li>
                            <li style="padding-top: 20px">
                              <a href="index.html#about">ABOUT</a>
                            </li>
                            <li style="padding-top: 20px">
                              <a href="index.html#special-collection"
                                >COLLECTION</a
                              >
                            </li>
                            <li style="padding-top: 20px">
                              <a href="index.html#our_team">NEWS</a>
                            </li>
                            <li style="padding-top: 20px">
                              <a href="index.html#contact">CONTACT</a>
                            </li>
                            <li style="padding-top: 20px">
                              <a href="./stockAllocationForm.html">INVESTOR FORM</a>
                            </li>
                           
                          </ul>
                        </div>
                      </nav> -->
                </div>
            </div>
        </div>
      </header>
    </div>

    <!-- end site-header -->
    <div class="container" style="margin-top: 100px">
      <div class="edit-container">
        <div class="header">
          <h3 class="text-center">Edit Stakeholders Details</h3>
        </div>

        <form id="editForm" onsubmit="handleSubmit(event)">
          <div class="row ">
            <div class="col-md-6">
              <label class="form-label">Name(s) of Holder(s)</label>
              <input
                type="text"
                class="form-control"
                id="nameOfHolders"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Occupation</label>
              <input
                type="text"
                class="form-control"
                id="occupation"
                required
              />
            </div>

            <div class="col-12">
              <label class="form-label">Address</label>
              <input type="text" class="form-control" id="address" required />
            </div>

            <div class="col-md-6">
              <label class="form-label">Contact No.</label>
              <input type="text" class="form-control" id="contactNo" required />
            </div>

            <div class="col-md-6">
              <label class="form-label">Place</label>
              <input type="text" class="form-control" id="place" required />
            </div>

            <div class="col-12">
              <label class="form-label">Nominee Name & Address</label>
              <input
                type="text"
                class="form-control"
                id="nomineeNameAndAddress"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Total Amount (â‚¹)</label>
              <input
                type="number"
                class="form-control"
                id="totalAmount"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Monthly Return of interest (%)</label>
              <input type="text" class="form-control" id="roi" required placeholder="example : 3.33 " />
            </div>

            <div class="col-md-6">
              <label class="form-label">Date</label>
              <input
                type="date"
                class="form-control"
                id="date"
                              />
            </div>
            <div class="col-md-6">
              <label class="form-label">Certificate No</label>
              <input
                type="text"
                class="form-control"
                id="certificateNo"
                readonly
                style="background-color: #e9ecef"
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Valid Till Date</label>
              <input type="date" class="form-control" id="validTill" required />
            </div>

           
          </div>
          <div class="row"  style="margin-top: 20px; display: flex;">
            <div class="col-md-6 col-lg-6 col-sm-12" style="display:flex ; justify-content: flex-start;" >
              <button
              type="button"
              class="btn btn-secondary"
              onclick="window.location.href='userlist.html'"
           >
              Back
            </button>
            </div>
            <div class="col-md-6 col-lg-6 col-sm-12" style="display:flex ; justify-content: flex-end;">
              <button type="submit" class="btn btn-primary"  >
                Save Changes
              </button>
            </div>
          </div>
         
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Get ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get("id");

      // Fetch user data when page loads
      async function fetchUserData() {
        try {
          const response = await fetch(
            `https://originalmahalaxmi.com:8084/api/v1/${userId}`
          );
          if (!response.ok) throw new Error("Failed to fetch data");
          const data = await response.json();

          // Populate form fields
          document.getElementById("nameOfHolders").value = data.nameOfHolders;
          document.getElementById("occupation").value = data.occupation;
          document.getElementById("address").value = data.address;
          document.getElementById("contactNo").value = data.contactNo;
          document.getElementById("place").value = data.place;
          document.getElementById("roi").value = data.roi;
          document.getElementById("nomineeNameAndAddress").value =
            data.nomineeNameAndAddress;
          document.getElementById("totalAmount").value = data.totalAmount;
          document.getElementById("certificateNo").value = data.certificateNo;

          // Format dates
          if (data.date) {
            document.getElementById("date").value = data.date.split("T")[0];
          }
          if (data.validTill) {
            document.getElementById("validTill").value =
              data.validTill.split("T")[0];
          }
        } catch (error) {
          console.error("Error:", error);
          alert("Error loading user data");
        }
      }

      // Handle form submission
      async function handleSubmit(event) {
        event.preventDefault();

        const payload = {
          nameOfHolders: document.getElementById("nameOfHolders").value,
          occupation: document.getElementById("occupation").value,
          address: document.getElementById("address").value,
          contactNo: document.getElementById("contactNo").value,
          place: document.getElementById("place").value,
          roi: document.getElementById("roi").value,
          nomineeNameAndAddress: document.getElementById(
            "nomineeNameAndAddress"
          ).value,
          totalAmount: parseFloat(document.getElementById("totalAmount").value),
          date: new Date(document.getElementById("date").value).toISOString(),
          // validTill: new Date(document.getElementById('validTill').value).toISOString(),
          //             date: new Date(document.getElementById('date').value).toISOString().split('T')[0],
          validTill: new Date(document.getElementById("validTill").value)
            .toISOString()
            .split("T")[0],

          certificateURL: "certificate",
          certificateNo: document.getElementById("certificateNo").value,
        };

        try {
          const response = await fetch(
            `https://originalmahalaxmi.com:8084/api/v1/admin/edit/${userId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            }
          );

          if (!response.ok) throw new Error("Failed to update");

          alert("Updated successfully");
          window.location.href = "userlist.html";
        } catch (error) {
          console.error("Error:", error);
          alert("Error updating user data");
        }
      }

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", fetchUserData);
    </script>
    <script>
      // Check for sessionStorage values
      document.addEventListener("DOMContentLoaded", function () {
        const token = sessionStorage.getItem("token");
        const message = sessionStorage.getItem("message");
        const status = sessionStorage.getItem("status");

        // Target the navbar
        const navbar = document.querySelector(".navbar-nav");

        // Logout Button
        const logoutItem = `
          <li class="nav-item">
                  <a class="nav-link text-white active" href="./userlist.html">INVESTOR LIST</a>
                
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="#" id="logoutBtn">LOGOUT</a>
                </li>
            `;

        // Login Button
        const loginItem = `
                <li class="nav-item">
                    <a class="nav-link text-white" href="./login.html">LOGIN</a>
                </li>
            `;

        if (token && message && status) {
          // If token, message, and status exist, show logout button
          navbar.innerHTML += logoutItem;

          // Add event listener for logout
          document
            .getElementById("logoutBtn")
            .addEventListener("click", function () {
              // Clear sessionStorage and redirect
              sessionStorage.clear();
              alert("You have successfully logged out.");
              window.location.href = "index.html";
            });
        } else {
          // If not logged in, ensure login button is visible
          navbar.innerHTML += loginItem;
        }
      });
    </script>

<!-- <script>
  document.getElementById('roi').addEventListener('input', function (e) {
      const value = e.target.value;
      if (!/^\d*\.?\d*$/.test(value)) {
          e.target.value = value.slice(0, -1);
      }
  });
  </script> -->

  <script>
    document.getElementById('roi').addEventListener('input', function (e) {
        const value = e.target.value;
        
        if (!/^\d{0,2}(\.\d{0,2})?$/.test(value)) {
            // Check which condition is violated
            if (value.includes('.') && value.split('.')[0].length > 2) {
                alert('You can not enter more than 2 digits before the decimal.');
            } else if (value.includes('.') && value.split('.')[1].length > 2) {
                alert('You can not enter more than 2 digits after the decimal.');
            } else if (!value.includes('.') && value.length > 2) {
                alert('You can enter only 2 digits if there is no decimal.');
            }
            
            e.target.value = value.slice(0, -1); // Remove the last invalid character
        }
    });
    </script>
  </body>
</html>
